<script>

//if (start != 0) {el.controls = true}
//else {el.controls = false}

var wheel = 0;
var timer = 1;
var seek = 0;

var scaleX = 1;		// gesture globals
var scaleY = 1;
var lastX = 1;
var lastY = 1;
var gest = 0;
var xp;
var yp;

function mouseDown(event) {xp = event.clientX; yp = event.clientY;}
function mouseUp(event) {xp = 0; gest = 0; lastX = scaleX; lastY = scaleY;}

function gesture(event) {						// on mouse move
var el = document.getElementById("modal-content");
if (!xp) {return;}
// if (gest == "skinny" && scaleX == 1) {lastX = 1; return;}
if (Math.abs(xp - event.clientX) > 5 && !gest) {gest = "skinny"; xp = event.clientX; xp = event.clientX;}
if (Math.abs(yp - event.clientY) > 5 && !gest) {gest = "magnify"; xp = event.clientX; yp = event.clientY;}
if (gest == "skinny") {scaleX = lastX + ((xp - event.clientX) / 500); el.style.transform = "scale(" + scaleX + "," + scaleY + ")";}
if (gest == "magnify") {scaleY = lastY - ((yp - event.clientY) / 250); scaleX = lastX - ((yp - event.clientY) / 250); el.style.transform = "scale(" + scaleX + "," + scaleY + ")";}
}

function playpause(id) {var el = document.getElementById(id); if (el.paused==true) {el.play(); el.muted=false;} else{el.pause();el.muted=true;}}

function play_media(id, start, index) {					// on mouse move
var el = document.getElementById(id);
var rect = el.getBoundingClientRect();
var xpos = (event.clientX - rect.left) / el.offsetWidth;
var ypos = (event.clientY - rect.top) / el.offsetHeight;
el.playbackRate = 0.8;
if (ypos > 0.9 && el.currentTime > start) {
el.currentTime = el.duration * xpos;
el.play();
document.getElementById("seek" + index).style.width = Math.ceil(xpos * el.offsetWidth) + "px";}
if (xpos < 0.1 && el.currentTime < start) {el.currentTime = start; el.play();}
seek = el.currentTime;
}

function open_modal(event, element, start) {				// on mouse leave
var rect = element.getBoundingClientRect();
var xpos = (event.clientX - rect.left) / element.offsetWidth;
var ypos = (event.clientY - rect.top) / element.offsetHeight;
var el = document.getElementById("modal-content");
el.src=element.src;
el.poster=element.src;
// alert(el.src);
if (xpos > 0.8 && ypos < 0.9) {
el.playbackRate = 0.8;
if (seek < start) {el.currentTime = start;}
else {el.currentTime = seek;}
el.loop = true;
var el2 = document.getElementById("myModal");
el2.style.display="flex";
el2.addEventListener("animationend", modal2_end);
document.getElementById("seek999").style.width = 0;
wheel=0;}
}

function close_modal(event, element) {					// on wheel move
var rect = element.getBoundingClientRect();
var xpos = (event.clientX - rect.left) / element.offsetWidth;
var ypos = (event.clientY - rect.top) / element.offsetHeight;
var el=document.getElementById("myModal");
var el2 = document.getElementById("modal-content");
var y = Math.abs(event.deltaY);
wheel += y;
if (xpos < 0.7 && wheel > 30) {						// close modal
document.querySelector("body").style.overflow = "auto";
el.style.animationName="fadeOut";
el.addEventListener("animationend", modal_end);
el.removeEventListener("animationend", modal2_end);
el2.pause();el2.muted = true;
wheel=0;scaleX=1;scaleY=1;seek=0;}
else if (ypos > 0.5 && wheel > 30 && timer == 1) {			// adjust video speed
timer = 0;
wheel = 0;
if (event.deltaY > 0) {speed = -0.05;}
else  {speed = 0.05;}
el2.playbackRate += speed;
setTimeout(function(){timer = 1;},200);}
else if (wheel > 30 && timer == 1) {					// fast seek video on wheel
timer = 0;
wheel = 0;
if (el2.paused == true) {interval = 0.1}
else {interval = el2.duration / 100}
if (event.deltaY > 0) {el2.currentTime += interval}
else  {el2.currentTime -= interval}
setTimeout(function(){timer = 1;},100);}
}

function modal_end() {
var el=document.getElementById("myModal");
el.style.display="none";
el.style.animationName="fadeIn";
el.removeEventListener("animationend", modal_end);
}

function modal2_end() {document.querySelector("body").style.overflow="hidden";
wheel=0;}	// stop bouncing scrollbar chrome




function spool(event, id, input, output) {	// spool folders, playlists, searches etc. into top html panel
var link = " ";
const z = input.split("|");
var el2 = document.getElementById(output);
var el = document.getElementById(id);

if (id == "all") {				// all search terms
z.sort();
for (const x of z) {
p = x; y = p.substring(0, 14); p=p.replace(/ /g, "%20"); link = link + "<a href=#" + p + "><li>" + y + "</li>" + "</a>";}
el2.innerHTML = link;}

if (id == "folders" || id == "sub" || id == "fav") {
for (x of z) {
  y = x.split("/"); 
  var x1 = y.pop(); x1 = y.pop();
  x1 = x1.substring(0, 14);
  p=x.replace(/ /g, "%20");
  link = link + "<a href=#" + p + "><li>" + x1 + "</li>" + "</a>";}
el2.innerHTML = link;}

if (id == "music" || id == "slides") {		// media pointer playlists
for (const x of z) {
  const y = x.split("/"); 
  var p = y.pop(); 
  var q = x.replace(p, "");
  q = p + "#" + q;
  p=p.replace(/.m3u/g, "");
  p = p.substring(0, 14);
  q=q.replace(/ /g, "%20");
  link = link + "<a href=#" + q + "><li>" + p + "</li>" + "</a>";}
el2.innerHTML = link;}

if (id == "search") {				// alpha selected search terms
z.sort();
var w = el.offsetWidth;
var x = ((event.clientX - el.offsetLeft - el.scrollLeft)/w) + 0.02;
var upper = String.fromCharCode(Math.floor(25 * x) + 65);
var lower = upper.toLowerCase();
const f_lower = z.filter(z => z.startsWith(lower));
const f_higher = z.filter(z => z.startsWith(upper));
y = f_higher.concat(f_lower);
for (const x of y) {
p = x; p=p.replace(/ /g, "%20"); link = link + "<a href=#" + p + "><li>" + x + "</li>" + "</a>";}
el2.innerHTML = link; el.innerHTML = upper;}}


function getCoords(event, id, sort, link, current) {	// return mouse over controls from html selection strip
var y = " ";
var of = " ";
var units = " ";
var el = document.getElementById(id);
var w = el.offsetWidth;
var x = (event.clientX - el.offsetLeft - el.scrollLeft)/w;
if (sort == 'Alpha') {y = Math.floor(26.9 * x) + 64;}
if (sort == 'Size') {y = Math.floor(100 * x) * 10;units = "Mb +"}
if (sort == 'Date') {y = Math.floor(37 * x);units = "months +"}
if (sort == 'Duration') {y = Math.floor(60 * x);units = "minutes +"}
if (id =='slider2' || id =='slider3') {y = Math.floor(sort*x)+1; units = sort; sort = "Page"; of = " of "}
if (id =='slider4') {sort = "View";}
if (current != "") {y = current;}
el.href= link + ".htm#" + sort + "#" + y;
if (sort =='Random' || sort =='ext' || sort =='Shuffle') {return;}
if (sort == 'Alpha') {y = String.fromCharCode(y);}
el.innerHTML = y + of + units;}

</script>

<style>

body {font-family: 'ClearSans-Thin'; overflow-x:hidden; background:#15110a; cursor:crosshair; color:#666666; font-size:0.8em; margin-top:200px;}
a:link {color:#15110a;}
a:visited {color:#15110a;}
a {text-decoration:none; color:#826858;}
a.slider {display:inline-block; width:35%; height:1.2em; border-radius:9px; color:#826858; transition:color 1.4s; font-size:1em; background-color:#1b1814; text-align:center}
a.slider:hover {color:red; transition:color 0.36s;}
ul.menu {column-gap:12px; margin:auto; list-style-type:none; padding:0; white-space:nowrap;}
ul.menu li {color:#826858; transition:color 1.4s;}
ul.menu li:hover {color:red; transition:color 0.36s;}
table {color:#826858; transition:color 1.4s; table-layout:fixed; border-collapse: collapse;}
table:hover {color:red; transition:color 0.36s;}
#hover_image {position:absolute; margin-left:3.8em; opacity:0; transition: opacity 0.4s; width:125px; height:auto;}
#hover_image:hover {opacity:1;}

.progress_bar {
  display:block;
  border-bottom:1px dotted orange;
  width:0;
  position:relative;
}

.controls {
  display:block;
  position:fixed;
  z-index:2;
  top:10em;
  left:2em;
  height:40em;
  width:7em;
  background-color:rgba(255,255,255,0)}

.modal {
  display:none;
  position:fixed;
  z-index:1;
  top:0;
  left:0;
  justify-content:center;
  align-items:center;
  height:100vh;
  width:100vw;
  cursor:crosshair;
  background-color:#15110a;
  animation-name:fadeIn;
  animation-duration:0.3s;
  transition-timing-function:ease;}

.modal-content {
  width:auto;
  height:auto;
  margin-left:-16em;
  max-width:45em;
  max-height:45em;
  border-radius:5%;}

@keyframes fadeIn {
  from {opacity:0; transform: scale(0.8,0.8);} 
  to {opacity:1; transform: scale(1,1);}}

@keyframes fadeOut {
  from {opacity:1; transform: scale(1,1);} 
  to {opacity:0; transform: scale(0.8,0.8);}}

</style>

